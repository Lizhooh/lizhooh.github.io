<!DOCTYPE html>
<html>
    <head><meta name="generator" content="Hexo 3.9.0">
    <meta charset="utf-8">
    <meta name="referrer" content="never">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="author" content="lizhooh">
    <meta name="google" content="notranslate">
    <meta name="url" content="http://me.lizhooh.com">
    <link rel="manifest" href="/manifest.json">
    
    
    
    <link rel="canonical" href="http://me.lizhooh.com/stories/2017/04/MongoDB/学习 Mongoose 的使用/">
    
    
    <title>学习 Mongoose 的使用 | Lizhooh 的技术博客 | 来至未来的大全栈工程师自我修养日记。深耕于：数据中台、智能运营、智能推荐、用户数据分析、用户数据治理等大数据领域。</title>
    
    <meta name="keywords" content="Lizhooh 的博客，我的博客，我来作主 &lt;br /&gt; 专注于研究：大前端开发领域，Nodejs 后端开发，混合式移动应用开发，Javascript 全栈式开发，数据挖掘与可视化 等技术。">
    <meta name="description" content="MongooseMongoose 是 MongoDB 的在 Nodejs 上的一个第三方客户端。 Mongoose 提供了一个简单的，基于模式的解决方案来建模您的应用程序数据。它包括内置的类型转换，验证，查询构建，业务逻辑钩子等。">
<meta name="keywords" content="Nodejs,数据库,MongoDB,学习笔记">
<meta property="og:type" content="article">
<meta property="og:title" content="学习 Mongoose 的使用">
<meta property="og:url" content="http://me.lizhooh.com/stories/2017/04/MongoDB/学习 Mongoose 的使用/index.html">
<meta property="og:site_name" content="Lizhooh 的技术博客">
<meta property="og:description" content="MongooseMongoose 是 MongoDB 的在 Nodejs 上的一个第三方客户端。 Mongoose 提供了一个简单的，基于模式的解决方案来建模您的应用程序数据。它包括内置的类型转换，验证，查询构建，业务逻辑钩子等。">
<meta property="og:locale" content="zh-Hans">
<meta property="og:updated_time" content="2021-06-15T06:10:52.828Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="学习 Mongoose 的使用">
<meta name="twitter:description" content="MongooseMongoose 是 MongoDB 的在 Nodejs 上的一个第三方客户端。 Mongoose 提供了一个简单的，基于模式的解决方案来建模您的应用程序数据。它包括内置的类型转换，验证，查询构建，业务逻辑钩子等。">
    
    <link rel="shortcut icon" href="/favicon.ico">
    <link rel="stylesheet" href="/css/style.css?v=2.2.0">
    <link href="//lib.baomitu.com/tippy.js/3.0.2/themes/light.css" rel="stylesheet">

    <!--<script src="/js/vconsole.min.js"></script> -->
    <script>
        window.lazyScripts=[];
    </script>

    <script>
    function IEVersion(){var e=navigator.userAgent;var b=e.indexOf("compatible")>-1&&e.indexOf("MSIE")>-1;var d=e.indexOf("Edge")>-1&&!b;var f=e.indexOf("Trident")>-1&&e.indexOf("rv:11.0")>-1;if(b){var a=new RegExp("MSIE (\\d+\\.\\d+);");a.test(e);var c=parseFloat(RegExp["$1"]);return c>=7&&c<=10?c:6}else{return -1}}if(IEVersion()!==-1){var text="检测到你使用的是 IE "+IEVersion()+" 内核浏览器，本博客使用了最新的前端技术，为了获得最佳的体验，请使用 Chrome、Opera、Firefox 等现代浏览器打开。";alert(text)};
    </script>
</head>


<body>
    <script>
        + function () {
            var S = window.localStorage;

            var theme = S.getItem('theme');
            var body = document.querySelector('body');
            if (body === null) {
                console.log('找不到 body 节点');
                return;
            }
            if (theme === 'night') {
                body.classList.add('night-mode');
            }

            function setTheme() {
                var theme = S.getItem('theme');
                var body = document.querySelector('body');
                if (body === null) {
                    console.log('找不到 body 节点');
                    return;
                }
                if (theme !== 'night') {
                    body.classList.add('night-mode');
                    S.setItem('theme', 'night');
                }
                else {
                    body.classList.remove('night-mode');
                    S.setItem('theme', 'not-night');
                }
            }

            function load() {
                var path = window.location.pathname;
                var theme = document.querySelector('#theme-toggle');
                theme.onclick = setTheme;

                if (document.body.clientWidth < 960) {
                    return;
                }

                // if (!/\/\d{2,4}/.test(window.location.pathname)) {
                //     return;
                // }

                if (!(path === '/' || /\/page\//.test(path))) {
                    return;
                }
            }
            window.onload = load;
        } ();
    </script>
    <div id="loading" class="active"></div>

    <aside id="menu" class="hide" >
  <div class="inner flex-row-vertical">
    <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="menu-off">
        <i class="icon icon-lg icon-close"></i>
    </a>
    <div class="brand-wrap">
      <div class="brand">
        <a href="/" class="avatar waves-effect waves-circle waves-light">
          <img src="/img/my.png">
        </a>
        <hgroup class="introduce">
          <h5 class="nickname" style="font-weight: bold">Lizhooh</h5>
          <span>
            <a href="mailto:lizhoohs@foxmail.com" title="lizhoohs@foxmail.com" class="mail">lizhoohs@foxmail.com</a>
          </span>

          <div style="margin-top: 5px; font-size: 92%"><b>337 篇文章，共 387.4k 字</b></div>
        </hgroup>
      </div>
    </div>
    <div class="scroll-wrap flex-col">
      <ul class="nav">
        
            <li class="waves-block waves-effect">
              <a href="/"  >
                <span class="icon-view">
                    <i class="icon icon-lg icon-home"></i>
                </span>
                <span class="text-view">
                    主页
                </span>
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="/tags/ES6-ES2015/"  >
                <span class="icon-view">
                    <i class="icon icon-lg icon-tags"></i>
                </span>
                <span class="text-view">
                    标签
                </span>
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="/categories/ES6"  >
                <span class="icon-view">
                    <i class="icon icon-lg icon-th-list"></i>
                </span>
                <span class="text-view">
                    分类
                </span>
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="/menu/about.html"  >
                <span class="icon-view">
                    <i class="icon icon-lg icon-user"></i>
                </span>
                <span class="text-view">
                    关于
                </span>
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="/menu/book.html"  >
                <span class="icon-view">
                    <i class="icon icon-lg icon-book"></i>
                </span>
                <span class="text-view">
                    创作
                </span>
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="/menu/npm.html"  >
                <span class="icon-view">
                    <i class="icon icon-lg icon-google"></i>
                </span>
                <span class="text-view">
                    Npm
                </span>
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="https://github.com/Lizhooh" target="_blank" >
                <span class="icon-view">
                    <i class="icon icon-lg icon-github"></i>
                </span>
                <span class="text-view">
                    Github
                </span>
              </a>
            </li>
        
      </ul>
    </div>
  </div>
</aside>


    <main id="main">
        <header class="top-header" id="header">
    <!-- 正文 -->
    <div class="flex-row">
        <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light on" id="menu-toggle">
          <i class="icon icon-lg icon-navicon"></i>
        </a>
        <div class="flex-col header-title ellipsis">学习 Mongoose 的使用</div>

        
        <div class="search-wrap" id="search-wrap">
            <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="back">
                <i class="icon icon-lg icon-chevron-left"></i>
            </a>
            <input type="text" id="key" class="search-input" autocomplete="off" placeholder="输入感兴趣的关键字">
            <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="search" title="搜索">
                <i class="icon icon-lg icon-search"></i>
            </a>
        </div>
        
        <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light on" id="theme-toggle" title="夜间模式">
          <i class="icon icon-lg icon-moon-o" style="font-weight: bold"></i>
        </a>
        <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light on">
            <i class="icon icon-lg icon-share-alt" style="font-weight: bold"></i>
        </a>
        
    </div>
</header>
<header class="content-header post-header" style="">

    <!--<div class="container fade-scale">-->
    <div class="container" id="container-header">
        <h1 class="title">学习 Mongoose 的使用</h1>

        <div class="meta-rest">
            <h1>学习 Mongoose 的使用</h1>
            <section>
                <img src="/img/my.png" class="avatar" />
                <div sty>
                    <span class="name">Lizhooh</span>
                    <span class="summary">前端开发者</span>
                    <span class="summary">温故而知新，可以为师矣。</span>
                </div>
            </section>
        </div>

        <h3 class="subtitle">
            
                <time datetime="2017-04-08T15:31:28.000Z" itemprop="datePublished" class="page-time">
    2017-04-08
</time>


	<ul class="article-category-list"><li class="article-category-list-item"><a class="article-category-list-link" href="/categories/MongoDB/">MongoDB</a></li></ul>


            
        </h3>
    </div>

    

</header>


<div class="container body-wrap">
    


    <aside class="post-widget">
        <nav class="post-toc-wrap" id="post-toc">
            <h4>TOC</h4>
            <ol class="post-toc"><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#Mongoose"><span class="post-toc-number">1.</span> <span class="post-toc-text">Mongoose</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#安装"><span class="post-toc-number">2.</span> <span class="post-toc-text">安装</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#连接数据库"><span class="post-toc-number">3.</span> <span class="post-toc-text">连接数据库</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#模型"><span class="post-toc-number">4.</span> <span class="post-toc-text">模型</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#创建模型"><span class="post-toc-number">4.1.</span> <span class="post-toc-text">创建模型</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#模型类型"><span class="post-toc-number">4.2.</span> <span class="post-toc-text">模型类型</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#模型检验"><span class="post-toc-number">4.3.</span> <span class="post-toc-text">模型检验</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#内置的检验器"><span class="post-toc-number">4.3.1.</span> <span class="post-toc-text">内置的检验器</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#自定义检验器"><span class="post-toc-number">4.3.2.</span> <span class="post-toc-text">自定义检验器</span></a></li></ol></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#创建实例"><span class="post-toc-number">4.4.</span> <span class="post-toc-text">创建实例</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#模型、实例方法"><span class="post-toc-number">4.5.</span> <span class="post-toc-text">模型、实例方法</span></a></li></ol></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#CRUD-增加、查询、更新和删除"><span class="post-toc-number">5.</span> <span class="post-toc-text">CRUD 增加、查询、更新和删除</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#增加"><span class="post-toc-number">5.1.</span> <span class="post-toc-text">增加</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#批量增加"><span class="post-toc-number">5.1.1.</span> <span class="post-toc-text">批量增加</span></a></li></ol></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#更新"><span class="post-toc-number">5.2.</span> <span class="post-toc-text">更新</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#删除"><span class="post-toc-number">5.3.</span> <span class="post-toc-text">删除</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#查询"><span class="post-toc-number">5.4.</span> <span class="post-toc-text">查询</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#直接查询"><span class="post-toc-number">5.4.1.</span> <span class="post-toc-text">直接查询</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#链式查询"><span class="post-toc-number">5.4.2.</span> <span class="post-toc-text">链式查询</span></a></li></ol></li></ol></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#虚拟属性"><span class="post-toc-number">6.</span> <span class="post-toc-text">虚拟属性</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#聚合框架"><span class="post-toc-number">7.</span> <span class="post-toc-text">聚合框架</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#文件结构"><span class="post-toc-number">8.</span> <span class="post-toc-text">文件结构</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#参考资料"><span class="post-toc-number">9.</span> <span class="post-toc-text">参考资料</span></a></li></ol>
        </nav>
    </aside>
    

<article id="post-MongoDB/学习 Mongoose 的使用"
  class="post-article article-type-post fade" itemprop="blogPost">

    <div class="post-card">
        <h1 class="post-card-title">学习 Mongoose 的使用</h1>
        <div class="post-meta">
            <time class="post-time" title="2017 年 04 月 08 日 23:31" datetime="2017-04-08T15:31:28.000Z"  itemprop="datePublished">
    2017-04-08
</time>

            
	<ul class="article-category-list"><li class="article-category-list-item"><a class="article-category-list-link" href="/categories/MongoDB/">MongoDB</a></li></ul>



            <span style="color: dodgerblue">
                字数：<span style="font-size: 14px;"> 3428</span>
            </span>
            <span>
                阅读预计<span style="font-size: 14px; color: orange;">  37.5  </span> 分钟
            </span>
        </div>

        <div class="post-content" id="post-content" itemprop="postContent">
            <h2 id="Mongoose"><a href="#Mongoose" class="headerlink" title="Mongoose"></a>Mongoose</h2><p><a href="http://mongoosejs.com/index.html" target="_blank" rel="noopener">Mongoose</a> 是 MongoDB 的在 Nodejs 上的一个第三方客户端。</p>
<p>Mongoose 提供了一个简单的，基于模式的解决方案来建模您的应用程序数据。它包括内置的类型转换，验证，查询构建，业务逻辑钩子等。</p>
<a id="more"></a>
<h2 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install --save mongoose</span><br></pre></td></tr></table></figure>
<p>如果需要使用 Promise，先设置 Promise</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mongoose.Promise = <span class="built_in">Promise</span>;</span><br></pre></td></tr></table></figure>
<h2 id="连接数据库"><a href="#连接数据库" class="headerlink" title="连接数据库"></a>连接数据库</h2><p>mongoose 连接数据库有很多种方式，这里列出两种。</p>
<blockquote>
<p>mongoose.connect(url): DB</p>
</blockquote>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> mongoose = <span class="built_in">require</span>(<span class="string">'mongoose'</span>);</span><br><span class="line"><span class="comment">//  无认证</span></span><br><span class="line">mongoose.connect(<span class="string">'mongodb://ip:port/test'</span>, &#123;</span><br><span class="line">    useMongoClient: <span class="literal">true</span>,  <span class="comment">// mongoose v4.0+</span></span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 认证</span></span><br><span class="line">mongoose.connect(<span class="string">'mongodb://user:password@ip:port/test'</span>, &#123;</span><br><span class="line">    useMongoClient: <span class="literal">true</span>,</span><br><span class="line">&#125;);</span><br><span class="line"><span class="comment">// mongoose.connect('mongodb://username:password@host:port/database?options...');</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> db = mongoose.connection;</span><br></pre></td></tr></table></figure>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> mongoose = <span class="built_in">require</span>(<span class="string">'mongoose'</span>);</span><br><span class="line"><span class="comment">//  它的返回值是连接后的数据库对象</span></span><br><span class="line"><span class="keyword">const</span> db = mongoose.connect(<span class="string">'mongodb://ip:port/test'</span>, &#123;</span><br><span class="line">    useMongoClient: <span class="literal">true</span>,</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<blockquote>
<p>Mongoose 的几个大版本的连接方式都有所不同，这里的是 v4.x 的连接方式。其他具体看官方文档。</p>
</blockquote>
<h2 id="模型"><a href="#模型" class="headerlink" title="模型"></a>模型</h2><p><strong>名词解释</strong></p>
<ul>
<li><code>Schema</code>： 一种以文件形式存储的数据库模型骨架，不具备数据库的操作能力，是一种数据类型的约束。</li>
<li><code>Model</code>： 由 Schema 发布生成的模型，具有抽象属性和行为的数据库操作对，可以看成是某类东西。</li>
<li><code>Entity</code>： 由 Model 创建的实例，他的操作也会影响数据库，可以看成是类的实例。</li>
</ul>
<h3 id="创建模型"><a href="#创建模型" class="headerlink" title="创建模型"></a>创建模型</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 会自动创建/寻找 cats 集合</span></span><br><span class="line">mongoose.model(<span class="string">'cat'</span>, <span class="keyword">new</span> mongoose.Schema(&#123;</span><br><span class="line">    name: <span class="built_in">String</span>,  <span class="comment">// 约束 cats 集合的 name 键为 String 类型</span></span><br><span class="line">&#125;, &#123;</span><br><span class="line">    versionKey: <span class="literal">false</span>   <span class="comment">// 去除自动添加版本号的键值，不然会自动添加 __v: 0</span></span><br><span class="line">&#125;));</span><br><span class="line"></span><br><span class="line"><span class="comment">// 也可以手动的指定集合，第三个参数指定集合名称</span></span><br><span class="line"><span class="comment">// mongoose.model('cat', schema, 'cat');</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 获得模型的引用</span></span><br><span class="line"><span class="keyword">const</span> Cat = mongoose.model(<span class="string">'cat'</span>);</span><br></pre></td></tr></table></figure>
<p>也可以在创建时获得引用：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> Cat = mongoose.model(<span class="string">'cat'</span>, <span class="keyword">new</span> mongoose.Schema(&#123;</span><br><span class="line">    name: <span class="built_in">String</span>,  <span class="comment">// 约束 cats 集合的 name 键为 String 类型</span></span><br><span class="line">    _id: <span class="built_in">Number</span>,</span><br><span class="line">&#125;, &#123;</span><br><span class="line">    versionKey: <span class="literal">false</span>   <span class="comment">// 去除自动添加版本号的键值。</span></span><br><span class="line">&#125;));</span><br></pre></td></tr></table></figure>
<h3 id="模型类型"><a href="#模型类型" class="headerlink" title="模型类型"></a>模型类型</h3><p>MongoDB 的文档数据是无限制类型的，为了更好的处理数据，mongoose 使用<code>Schema</code>进行类型的约束。<br>当插入，与约束类型不匹配时，会插入失败。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> blogSchema = <span class="keyword">new</span> Schema(&#123;</span><br><span class="line">    title:  <span class="built_in">String</span>,</span><br><span class="line">    author: &#123;</span><br><span class="line">        type: <span class="built_in">String</span>,</span><br><span class="line">        required: <span class="literal">true</span>,     <span class="comment">// 必填</span></span><br><span class="line">        unique: <span class="literal">true</span>,       <span class="comment">// 唯一性</span></span><br><span class="line">    &#125;,</span><br><span class="line">    body:   <span class="built_in">String</span>,</span><br><span class="line">    comments: [&#123;            <span class="comment">// 评论是一个数组</span></span><br><span class="line">        body: <span class="built_in">String</span>,</span><br><span class="line">        date: <span class="built_in">Date</span></span><br><span class="line">    &#125;],</span><br><span class="line">    date: &#123;</span><br><span class="line">        type: <span class="built_in">Date</span>,         <span class="comment">// 类型</span></span><br><span class="line">        <span class="keyword">default</span>: <span class="built_in">Date</span>.now   <span class="comment">// 默认值</span></span><br><span class="line">    &#125;,</span><br><span class="line">    hidden: <span class="built_in">Boolean</span>,</span><br><span class="line">    meta: &#123; <span class="attr">votes</span>: <span class="built_in">Number</span>, <span class="attr">favs</span>:  <span class="built_in">Number</span>&#125;,</span><br><span class="line">    user: &#123;</span><br><span class="line">        age: &#123;</span><br><span class="line">            type: <span class="built_in">Number</span>,</span><br><span class="line">            min: <span class="number">18</span>,        <span class="comment">// 年龄的最少值</span></span><br><span class="line">            max: <span class="number">65</span></span><br><span class="line">        &#125;,</span><br><span class="line">        name: &#123;</span><br><span class="line">            type: <span class="built_in">String</span>,</span><br><span class="line">            required: <span class="literal">true</span>  <span class="comment">// 不能为空</span></span><br><span class="line">        &#125;,</span><br><span class="line">        addr: [<span class="built_in">String</span>],     <span class="comment">// 字符串数组</span></span><br><span class="line">    &#125;,</span><br><span class="line">    other: Other,           <span class="comment">// 引用其他 schema</span></span><br><span class="line">    test: Other.tree.test,  <span class="comment">// 引用其他 schema 属性</span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p><code>Schema</code> 的第二个参数是配置项，它有以下属性：</p>
<table>
<thead>
<tr>
<th style="text-align:left">属性</th>
<th style="text-align:left">默认值</th>
<th style="text-align:left">描述</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">autoIndex</td>
<td style="text-align:left">true</td>
<td style="text-align:left">自动建立索引。</td>
</tr>
<tr>
<td style="text-align:left">capped</td>
<td style="text-align:left">16M</td>
<td style="text-align:left">最大文档大小。</td>
</tr>
<tr>
<td style="text-align:left">collection</td>
<td style="text-align:left"></td>
<td style="text-align:left">集合名称，默认情况下 mongoose 会使用名称的复数形式。</td>
</tr>
<tr>
<td style="text-align:left">emitIndexErrors</td>
<td style="text-align:left"></td>
<td style="text-align:left">发出“索引”事件。</td>
</tr>
<tr>
<td style="text-align:left">id</td>
<td style="text-align:left">ObjectId</td>
<td style="text-align:left">模型实例的 id。 new mongoose.Types.ObjectId()</td>
</tr>
<tr>
<td style="text-align:left">_id</td>
<td style="text-align:left">ObjectId</td>
<td style="text-align:left">与 id 一样，作为存储进 MongoDB 里的 _id 里。</td>
</tr>
<tr>
<td style="text-align:left">minimize</td>
<td style="text-align:left">true</td>
<td style="text-align:left">是否删除空字段。</td>
</tr>
<tr>
<td style="text-align:left">read</td>
<td style="text-align:left">false</td>
<td style="text-align:left">允许在架构级别设置查询＃读取选项。</td>
</tr>
<tr>
<td style="text-align:left">safe</td>
<td style="text-align:left">false</td>
<td style="text-align:left">这个选项通过所有操作传递给 MongoDB，并指定是否应该将错误返回给我们的回调以及调整写入行为。</td>
</tr>
<tr>
<td style="text-align:left">shardKey</td>
<td style="text-align:left"></td>
<td style="text-align:left">shardKey 当我们有一个分片的 MongoDB 架构时使用这个选项。</td>
</tr>
<tr>
<td style="text-align:left">strict</td>
<td style="text-align:left">true</td>
<td style="text-align:left">strict 选项（默认启用）确保传递给我们模型构造函数的值在我们的模式中没有被指定，不会被保存到数据库中。</td>
</tr>
<tr>
<td style="text-align:left">toJSON</td>
<td style="text-align:left">function</td>
<td style="text-align:left">返回模型实例的 JSON 格式。</td>
</tr>
<tr>
<td style="text-align:left">toObject</td>
<td style="text-align:left">function</td>
<td style="text-align:left">返回模型实例的 Object 格式。</td>
</tr>
<tr>
<td style="text-align:left">typeKey</td>
<td style="text-align:left">true</td>
<td style="text-align:left">默认情况下，如果在模式中有一个带有“type”键的对象，mongoose会将其解释为类型声明。</td>
</tr>
<tr>
<td style="text-align:left">validateBeforeSave</td>
<td style="text-align:left">true</td>
<td style="text-align:left">默认情况下，文档在被保存到数据库之前会自动进行检验。</td>
</tr>
<tr>
<td style="text-align:left">versionKey</td>
<td style="text-align:left">“0”</td>
<td style="text-align:left">versionKey 是在 mongoose 首次创建时在每个文档上设置的属性。该键值包含 文档的内部 修订版本。</td>
</tr>
<tr>
<td style="text-align:left">collation</td>
<td style="text-align:left">true</td>
<td style="text-align:left">为每个查询和聚合设置一个默认的排序规则。</td>
</tr>
<tr>
<td style="text-align:left">skipVersioning</td>
<td style="text-align:left">false</td>
<td style="text-align:left">skipVersioning 允许从版本控制中排除路径。</td>
</tr>
<tr>
<td style="text-align:left">timestamps</td>
<td style="text-align:left">false</td>
<td style="text-align:left">如果设置 timestamps，mongoose 将添加 createdAt 和 updatedAt 字段到你的模型里。</td>
</tr>
<tr>
<td style="text-align:left">retainKeyOrder</td>
<td style="text-align:left"></td>
<td style="text-align:left">在 mongoose4，update() 和 findOneAndUpdate() 只检查顶层架构的严格模式设置。</td>
</tr>
</tbody>
</table>
<p><strong>注意的地方：</strong></p>
<ul>
<li>如果设置了 unique 就代表字段是唯一的，如果插入相同的会报错。</li>
<li>如果设置了 required 就代表是必填字段，如果留空会报错。</li>
<li>如果类型定义为 []，在插入时没有使用数组，这时不会报错，mongoose 会把插入的数组当作数组的一项放进数组，最后在 mongod 看到的是数组。</li>
<li>如果没有给定默认值，在插入时没有对应的字段，最后在 mongodb 里是没有对应字段的。</li>
<li><p>默认情况下，在类型为 [{ name: String }]，类似的子文档， mongoose 它会添加 _id。</p>
  <figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[&#123;</span><br><span class="line">    name: <span class="string">'a'</span>,</span><br><span class="line">    _id: <span class="string">'...'</span>,</span><br><span class="line">&#125;]</span><br></pre></td></tr></table></figure>
<p>如果在数组里不需要 _id，可以使用 _id: false 去掉。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">user: [<span class="keyword">new</span> Schema(&#123;</span><br><span class="line">    name: <span class="built_in">String</span>,</span><br><span class="line">&#125;, &#123; <span class="attr">_id</span>: <span class="literal">false</span> &#125;)]</span><br></pre></td></tr></table></figure>
</li>
<li><p>在默认的情况下 mongoose 会删除空属性值以尽量的节省空间，可以使用 <code>{ minimize: false }</code> 来去除。</p>
</li>
<li>如果设置 timestamps，mongoose 将添加 createdAt 和 updatedAt 字段到你的模型里。</li>
</ul>
<h3 id="模型检验"><a href="#模型检验" class="headerlink" title="模型检验"></a>模型检验</h3><p>当使用 Schema 定义模型时，可以使用 type 属性来指定模型字段类型。指定模型字段类型之后，在插入数据时 mongoose 会对数据进行检验。</p>
<p>对于检验，它有几个<strong>原则</strong>：</p>
<ul>
<li>检验在 SchemaType 中定义。</li>
<li>检验是中间件。Mongoose pre('save') 默认将检验注册为每个模式的钩子。</li>
<li>您可以使用 doc.validate(callback) 或手动运行检验 doc.validateSync()。</li>
<li>检验器不在未定义的值上运行。唯一的例外是 <code>required</code> 检验器。</li>
<li>检验是异步递归的; 当您调用 Model.save 时，也会执行子文档检验。如果发生错误，您的 Model.save 回调会收到它。</li>
<li>检验是可自定义的。</li>
</ul>
<h4 id="内置的检验器"><a href="#内置的检验器" class="headerlink" title="内置的检验器"></a>内置的检验器</h4><p>mongoose 里内置了几个检验器。</p>
<ul>
<li>所有 SchemaTypes 都有内置的必需检验器。所需的检验器使用 SchemaType 的 checkRequired() 函数来确定该值是否满足所需的检验器。</li>
<li>Number 有 <code>min</code> 和 <code>max</code> 的检验器。</li>
<li>String 有 <code>enum</code>，<code>match</code>，<code>maxLength</code> 和 <code>minLength</code> 检验器。</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> breakfastSchema = <span class="keyword">new</span> Schema(&#123;</span><br><span class="line">    eggs: &#123;</span><br><span class="line">        type: <span class="built_in">Number</span>,</span><br><span class="line">        min: [<span class="number">6</span>, <span class="string">'Too few eggs'</span>],       <span class="comment">// 最小是 6，错误信息为 'Too ...'</span></span><br><span class="line">        max: <span class="number">12</span></span><br><span class="line">    &#125;,</span><br><span class="line">    bacon: &#123;</span><br><span class="line">        type: <span class="built_in">Number</span>,</span><br><span class="line">        required: [<span class="literal">true</span>, <span class="string">'Why no bacon?'</span>]</span><br><span class="line">    &#125;,</span><br><span class="line">    drink: &#123;</span><br><span class="line">        type: <span class="built_in">String</span>,</span><br><span class="line">        enum: [<span class="string">'Coffee'</span>, <span class="string">'Tea'</span>],        <span class="comment">// 枚举范围</span></span><br><span class="line">        required: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">this</span>.bacon &gt; <span class="number">3</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    color: &#123;</span><br><span class="line">        type: <span class="built_in">String</span>,</span><br><span class="line">        enum: &#123;</span><br><span class="line">            values: [<span class="string">'blue'</span>, <span class="string">'yellow'</span>, <span class="string">'green'</span>, <span class="string">'red'</span>],</span><br><span class="line">            message: <span class="string">'color error'</span>      <span class="comment">// 错误信息</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<h4 id="自定义检验器"><a href="#自定义检验器" class="headerlink" title="自定义检验器"></a>自定义检验器</h4><p>如果内置的验证器不够用，你可以定义自定义的检验器来满足你的需求。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> userSchema = <span class="keyword">new</span> Schema(&#123;</span><br><span class="line">    phone: &#123;</span><br><span class="line">        type: <span class="built_in">String</span>,</span><br><span class="line">        validate: &#123;</span><br><span class="line">            validator: <span class="function"><span class="keyword">function</span> (<span class="params">v</span>) </span>&#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="regexp">/\d&#123;3&#125;-\d&#123;3&#125;-\d&#123;4&#125;/</span>.test(v);</span><br><span class="line">            &#125;,</span><br><span class="line">            message: <span class="string">'&#123;VALUE&#125; is not a valid phone number!'</span></span><br><span class="line">        &#125;,</span><br><span class="line">        required: [<span class="literal">true</span>, <span class="string">'User phone number required'</span>]</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>当发生错误时，有几个可用的信息：</p>
<ul>
<li>{PATH} 被替换为无效的文档路径。</li>
<li>{VALUE} 被替换为无效值。</li>
<li>{TYPE} 被替换为诸如“正则表达式”，“最小”或“用户定义”的验证器类型。</li>
<li>{MIN} 用 Number.min 验证器的声明最小值替换。</li>
<li>{MAX} 被 Number.max 验证器声明的最大值替换。</li>
</ul>
<h3 id="创建实例"><a href="#创建实例" class="headerlink" title="创建实例"></a>创建实例</h3><p>创建实例也就是创建<code>Entity</code>，需要用到数据。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 根据模型，创建一个"黑猫"</span></span><br><span class="line"><span class="keyword">const</span> blackCat = <span class="keyword">new</span> Cat(&#123; <span class="attr">name</span>: <span class="string">'黑猫'</span>, <span class="attr">_id</span>: <span class="number">1</span> &#125;);</span><br></pre></td></tr></table></figure>
<h3 id="模型、实例方法"><a href="#模型、实例方法" class="headerlink" title="模型、实例方法"></a>模型、实例方法</h3><p>可以在创建<code>Schema</code>时添加，实例的方法。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> catSchema =  mongoose.Schema(&#123;</span><br><span class="line">    name: <span class="built_in">String</span>,</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 根据模型，创建一个"黑猫"</span></span><br><span class="line"><span class="keyword">const</span> blackCat = <span class="keyword">new</span> Cat(&#123; <span class="attr">name</span>: <span class="string">'黑猫'</span>, <span class="attr">_id</span>: <span class="number">1</span> &#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 实例方法</span></span><br><span class="line">catSchema.methods.say = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="keyword">this</span>.name, <span class="string">': 喵喵喵'</span>);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 静态方法</span></span><br><span class="line">catSchema.statics.says = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'喵喵喵'</span>);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 这样就可以在实例里使用了</span></span><br><span class="line">blackCat.say();  <span class="comment">// 黑猫：喵喵喵</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 静态方法，需要使用模型名</span></span><br><span class="line">Cat.says();      <span class="comment">// 喵喵喵</span></span><br></pre></td></tr></table></figure>
<h2 id="CRUD-增加、查询、更新和删除"><a href="#CRUD-增加、查询、更新和删除" class="headerlink" title="CRUD 增加、查询、更新和删除"></a>CRUD 增加、查询、更新和删除</h2><p>CRUD 分为<code>Model</code>与<code>Entity</code>的 CRUD。</p>
<h3 id="增加"><a href="#增加" class="headerlink" title="增加"></a>增加</h3><p>相当于 insert 操作，注意确保数据的唯一性，插入相同的会报错，特别是<code>_id</code>自定义的时候。<br>如果在，插入时缺少字段，就会报错：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">Error</span>: <span class="built_in">document</span> must have an name before saving</span><br></pre></td></tr></table></figure>
<blockquote>
<p>create: 使用 Model 来操作</p>
</blockquote>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">Cat.create(&#123; <span class="attr">name</span>: <span class="string">'花猫'</span>, <span class="attr">_id</span>: <span class="number">2</span> &#125;, (err, result) =&gt; &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(result);</span><br><span class="line">    <span class="comment">// &#123; name: '花猫', _id: 2 &#125;</span></span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 当然也可以使用 Promise</span></span><br><span class="line">Cat.create(&#123; <span class="attr">name</span>: <span class="string">'花猫'</span>, <span class="attr">_id</span>: <span class="number">2</span> &#125;).then(<span class="function"><span class="params">result</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(result);</span><br><span class="line">    <span class="comment">// &#123; name: '花猫', _id: 2 &#125;</span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<blockquote>
<p>save: 使用 Entity 来操作</p>
</blockquote>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> whitecat = <span class="keyword">new</span> Cat(&#123; <span class="attr">name</span>: <span class="string">'白猫'</span>, <span class="attr">_id</span>: <span class="number">3</span> &#125;);</span><br><span class="line"></span><br><span class="line">whitecat.save(<span class="function">(<span class="params">err, result</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(result);</span><br><span class="line">    <span class="comment">// &#123; name: '白猫', _id: 3 &#125;</span></span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 当然也可以使用 Promise</span></span><br><span class="line">whitecat.save().then(<span class="function"><span class="params">result</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(result);</span><br><span class="line">    <span class="comment">// &#123; name: '白猫', _id: 3 &#125;</span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>还可以，修改再保存，注意下面的细节差异。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> huacat = <span class="keyword">new</span> Cat(&#123; <span class="attr">name</span>: <span class="string">'花猫'</span>, <span class="attr">_id</span>: <span class="number">4</span> &#125;);</span><br><span class="line"></span><br><span class="line">huacat.save(<span class="function">(<span class="params">err, result</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(result);</span><br><span class="line">    huacat.name = <span class="string">'神猫'</span>;</span><br><span class="line"></span><br><span class="line">    huacat.save(<span class="function">(<span class="params">err, result</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(result);</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// &#123; name: '花猫', _id: 4 &#125;</span></span><br><span class="line"><span class="comment">// &#123; name: '神猫', _id: 4 &#125;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> huacat2 = <span class="keyword">new</span> Cat(&#123; <span class="attr">name</span>: <span class="string">'花猫'</span>, <span class="attr">_id</span>: <span class="number">4</span> &#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 报错， _id 重复</span></span><br><span class="line">huacat2.save(<span class="function">(<span class="params">err, result</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(result);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<h4 id="批量增加"><a href="#批量增加" class="headerlink" title="批量增加"></a>批量增加</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">Cat.create([</span><br><span class="line">    &#123; <span class="attr">name</span>: <span class="string">'花猫'</span>, <span class="attr">_id</span>: <span class="number">5</span> &#125;,</span><br><span class="line">    &#123; <span class="attr">name</span>: <span class="string">'神猫'</span>, <span class="attr">_id</span>: <span class="number">6</span> &#125;,</span><br><span class="line">]).then(<span class="function"><span class="params">result</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(result);</span><br><span class="line">    <span class="comment">// [</span></span><br><span class="line">    <span class="comment">//     &#123; name: '花猫', _id: 5 &#125;,</span></span><br><span class="line">    <span class="comment">//     &#123; name: '神猫', _id: 6 &#125;</span></span><br><span class="line">    <span class="comment">// ]</span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<h3 id="更新"><a href="#更新" class="headerlink" title="更新"></a>更新</h3><p>有许多方式来更新文件，以下是常用的传统方式。</p>
<blockquote>
<p>findById + save</p>
</blockquote>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Cat.findById(<span class="number">1</span>, (err, cat) =&gt; &#123;</span><br><span class="line">    cat.name = <span class="string">'新花猫'</span>;</span><br><span class="line">    cat.save(); <span class="comment">// &#123; _id: 1, name: '新花猫' &#125;</span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<blockquote>
<p>findById + update</p>
</blockquote>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 注意，在 MongoDB 里是不允许修改 _id，所以要把 _id delete</span></span><br><span class="line"><span class="keyword">const</span> id = <span class="number">1</span>;</span><br><span class="line">Cat.findById(id, (err, cat) =&gt; &#123;</span><br><span class="line">    cat.name = <span class="string">'旧花猫'</span>;</span><br><span class="line">    <span class="keyword">delete</span> cat._id;</span><br><span class="line">    Cat.update(&#123; <span class="attr">_id</span>: id &#125;, &#123; <span class="attr">$set</span>: cat &#125;).then(<span class="function"><span class="params">result</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(result);</span><br><span class="line">        <span class="comment">// &#123; ok: 1, nModified: 1, n: 1 &#125;</span></span><br><span class="line">    &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<blockquote>
<p>update(query, date, option, callback) 和 mongodb 的 update 语法差不多</p>
</blockquote>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 这样只会更新第一个匹配</span></span><br><span class="line">Cat.update(</span><br><span class="line">    &#123; <span class="attr">name</span>: <span class="string">'花猫'</span> &#125;,</span><br><span class="line">    &#123; <span class="attr">$set</span>: &#123; <span class="attr">name</span>: <span class="string">'新花猫'</span> &#125; &#125;</span><br><span class="line">).then(<span class="function"><span class="params">result</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(result);</span><br><span class="line">    <span class="comment">// &#123; ok: 1, nModified: 1, n: 1 &#125;</span></span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 更新所有匹配项</span></span><br><span class="line">Cat.update(</span><br><span class="line">    &#123; <span class="attr">name</span>: <span class="string">'花猫'</span> &#125;,</span><br><span class="line">    &#123; <span class="attr">$set</span>: &#123; <span class="attr">name</span>: <span class="string">'新花猫'</span> &#125; &#125;,</span><br><span class="line">    &#123; <span class="attr">multi</span>: <span class="literal">true</span> &#125;</span><br><span class="line">).then(<span class="function"><span class="params">result</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(result);</span><br><span class="line">    <span class="comment">// &#123; ok: 1, nModified: 2, n: 2 &#125;</span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<blockquote>
<p>findByIdAndUpdate</p>
</blockquote>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> id = <span class="number">1</span>;</span><br><span class="line">Cat.findByIdAndUpdate(id, &#123; <span class="attr">$set</span>: &#123; <span class="attr">name</span>: <span class="string">'新花猫'</span> &#125; &#125;).then(<span class="function"><span class="params">cat</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(cat);</span><br><span class="line">    <span class="comment">// &#123; _id: 1, name: '旧花猫' &#125; 返回的是查询到的值</span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<h3 id="删除"><a href="#删除" class="headerlink" title="删除"></a>删除</h3><p>和新增一样，删除也有 2 种方式，但 Entity 和 Model 都使用 remove 方法。</p>
<blockquote>
<p>remove: 使用 Model 来操作</p>
</blockquote>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Cat.remove(&#123; <span class="attr">_id</span>: <span class="number">1</span> &#125;).then(<span class="function"><span class="params">comman</span> =&gt;</span> comman.result).then(<span class="function"><span class="params">result</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(result);</span><br><span class="line">    <span class="comment">// &#123; ok: 1, n: 1 &#125; n = 1 才表示删除成功</span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<blockquote>
<p>remove: 使用 Entity 来操作</p>
</blockquote>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> whitecat = <span class="keyword">new</span> Cat(&#123; <span class="attr">name</span>: <span class="string">'白猫'</span>, <span class="attr">_id</span>: <span class="number">1</span> &#125;);</span><br><span class="line"><span class="comment">// 先添加, 10 秒后再删除</span></span><br><span class="line">whitecat.save().then(<span class="function"><span class="params">result</span> =&gt;</span> &#123;</span><br><span class="line">    setTimeout(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">        whitecat.remove().then(<span class="function"><span class="params">cat</span> =&gt;</span> &#123;</span><br><span class="line">            <span class="built_in">console</span>.log(cat);</span><br><span class="line">            <span class="comment">// &#123; name: '白猫', _id: 1 &#125;</span></span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;, <span class="number">1000</span> * <span class="number">10</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<blockquote>
<p>findByIdAndRemove</p>
</blockquote>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> id = <span class="number">2</span>;</span><br><span class="line">Cat.findByIdAndRemove(id).then(<span class="function"><span class="params">cat</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(cat);</span><br><span class="line">    <span class="comment">// &#123; _id: 2, name: '新花猫' &#125; cat 不为 null 表示删除成功</span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<h3 id="查询"><a href="#查询" class="headerlink" title="查询"></a>查询</h3><p>查询都是对 Model，进行操作，没有 Entity 的事。查询有两种方式：<code>直接查询</code>,<code>链式查询</code>。</p>
<h4 id="直接查询"><a href="#直接查询" class="headerlink" title="直接查询"></a>直接查询</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">Cat.find(&#123; <span class="attr">name</span>: <span class="string">'白猫'</span> &#125;, &#123; <span class="attr">_id</span>: <span class="number">0</span> &#125;, (err, result) =&gt; &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(result);</span><br><span class="line">    <span class="comment">// [ &#123; name: '白猫' &#125; ]</span></span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 或者使用 Promise</span></span><br><span class="line">Cat.find(&#123; <span class="attr">name</span>: <span class="string">'白猫'</span> &#125;).then(<span class="function"><span class="params">result</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(result);</span><br><span class="line">    <span class="comment">// [ &#123; _id: 1, name: '白猫' &#125; ]</span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>还可以使用正则，多项查询：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Cat.find(&#123; <span class="attr">name</span>: <span class="regexp">/.*猫+/</span> &#125;).count().then(<span class="function"><span class="params">count</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(count); <span class="comment">// 3, 表示有三只猫</span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>所有与查询模型相关的 API：</p>
<ul>
<li>Cat.find();</li>
<li>Cat.findById();</li>
<li>Cat.findByIdAndRemove();</li>
<li>Cat.findByIdAndUpdate();</li>
<li>Cat.findOne();</li>
<li>Cat.findOneAndRemove();</li>
<li>Cat.findOneAndUpdate();</li>
</ul>
<h4 id="链式查询"><a href="#链式查询" class="headerlink" title="链式查询"></a>链式查询</h4><p>下面一段是典型的链式查询，最后需要调用<code>exec(callback)</code>来表示结束链式。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">Person</span><br><span class="line">    .find(&#123; <span class="attr">occupation</span>: <span class="regexp">/host/</span> &#125;)</span><br><span class="line">    .where(<span class="string">'name.last'</span>).equals(<span class="string">'Ghost'</span>)</span><br><span class="line">    .where(<span class="string">'age'</span>).gt(<span class="number">17</span>).lt(<span class="number">66</span>)</span><br><span class="line">    .where(<span class="string">'likes'</span>).in([<span class="string">'vaporizing'</span>, <span class="string">'talking'</span>])</span><br><span class="line">    .limit(<span class="number">10</span>)</span><br><span class="line">    .sort(<span class="string">'-occupation'</span>)</span><br><span class="line">    .select(<span class="string">'name occupation'</span>)</span><br><span class="line">    .exec(callback);</span><br></pre></td></tr></table></figure>
<p>猫示例：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">Cat.find(&#123; <span class="attr">name</span>: <span class="regexp">/.*猫$/</span> &#125;)</span><br><span class="line">    .where(<span class="string">'_id'</span>).gte(<span class="number">1</span>).lt(<span class="number">3</span>)  <span class="comment">// 1 &lt;= _id &lt; 3</span></span><br><span class="line">    .sort(<span class="string">'-_id'</span>)               <span class="comment">// - 表示降序</span></span><br><span class="line">    <span class="comment">// .exec()                  // 调用 then 时自动调用 exec</span></span><br><span class="line">    .then(<span class="function"><span class="params">result</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(result);</span><br><span class="line">        <span class="comment">// [ &#123; _id: 2, name: '肥猫' &#125;, &#123; _id: 1, name: '白猫' &#125; ]</span></span><br><span class="line">    &#125;);</span><br></pre></td></tr></table></figure>
<h2 id="虚拟属性"><a href="#虚拟属性" class="headerlink" title="虚拟属性"></a>虚拟属性</h2><p>虚拟属性是一个不插入 Mongodb 的属性，但是它可以在 Mongoose 模型的实例里使用。<br>定义虚拟属性：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">UserSchema.virtual(<span class="string">'name'</span>)</span><br><span class="line">    .get(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.name.first + <span class="string">' '</span> + <span class="keyword">this</span>.name.last;</span><br><span class="line">    &#125;);</span><br></pre></td></tr></table></figure>
<p>虚拟属性定义时的 this 是指向模型实例的。</p>
<p>使用虚拟属性：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 创建实例</span></span><br><span class="line"><span class="keyword">const</span> user = <span class="keyword">new</span> User(&#123; <span class="attr">name</span>: &#123; <span class="attr">first</span>: <span class="string">'Li'</span>, <span class="attr">last</span>: <span class="string">'Zhooh'</span> &#125; &#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 使用虚属性</span></span><br><span class="line">user.name; <span class="comment">// Lizhooh</span></span><br></pre></td></tr></table></figure>
<h2 id="聚合框架"><a href="#聚合框架" class="headerlink" title="聚合框架"></a>聚合框架</h2><p>聚合框架是 Mongodb 里的内容，它为你提供有用的工具。使用聚合框架可以对集合中的文档进行变换和组合。基本上可以使用多个构件创建一个管道（pipeline），用于对一连串的文档进行处理。</p>
<p>构件包括了：</p>
<ul>
<li><code>筛选</code>（filtering）</li>
<li><code>投射</code>（projecting）</li>
<li><code>分组</code>（grouping）</li>
<li><code>排序</code>（sorting）</li>
<li><code>限制</code>（limiting）</li>
<li><code>跳过</code>（skipping）</li>
</ul>
<p>例如我们可以利用集合通过所有 count 的累加和：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">Cat.aggregate([&#123;</span><br><span class="line">    $group: &#123;</span><br><span class="line">        sum: &#123; <span class="attr">$sum</span>: <span class="string">'$user_count'</span> &#125;,</span><br><span class="line">    &#125;</span><br><span class="line">&#125;]).then(<span class="function"><span class="params">res</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(res);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>具体这里不一一细数。</p>
<h2 id="文件结构"><a href="#文件结构" class="headerlink" title="文件结构"></a>文件结构</h2><p>推荐的文件结构:</p>
<blockquote>
<p>mongoose-config.js 配置 MongoDB 的连接与配置项</p>
</blockquote>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> mongoose = <span class="built_in">require</span>(<span class="string">'mongoose'</span>);</span><br><span class="line"></span><br><span class="line">mongoose.Promise = <span class="built_in">Promise</span>;</span><br><span class="line">mongoose.connect(<span class="string">'mongodb://127.0.0.1/test'</span>, &#123;</span><br><span class="line">    useMongoClient: <span class="literal">true</span>,</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 引入模型</span></span><br><span class="line"><span class="built_in">require</span>(<span class="string">'./model/user'</span>);</span><br><span class="line"><span class="built_in">require</span>(<span class="string">'./model/student'</span>);</span><br><span class="line"><span class="built_in">require</span>(<span class="string">'./model/teacher'</span>);</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = mongoose.connection;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>model 文件夹，放置一些模型结构 - model/user.js</p>
</blockquote>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> mongoose = <span class="built_in">require</span>(<span class="string">'mongoose'</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> userScheme = <span class="keyword">new</span> mongoose.Schema(&#123;</span><br><span class="line">    name: &#123;</span><br><span class="line">        type: <span class="built_in">String</span>,</span><br><span class="line">        trim: <span class="literal">true</span>,</span><br><span class="line">    &#125;,</span><br><span class="line">    age: &#123;</span><br><span class="line">        type: <span class="built_in">Number</span>,</span><br><span class="line">        max: <span class="number">120</span>,</span><br><span class="line">        min: <span class="number">0</span>,</span><br><span class="line">    &#125;</span><br><span class="line">&#125;, &#123; <span class="attr">versionKey</span>: <span class="literal">false</span> &#125;);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> User = mongoose.model(<span class="string">'user'</span>, userScheme, <span class="string">'user'</span>);</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = User;</span><br></pre></td></tr></table></figure>
<p>最后在使用的文件里引用：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> db = <span class="built_in">require</span>(<span class="string">'./mongoose-config'</span>);</span><br><span class="line"><span class="comment">// const User = require('./model/user');</span></span><br><span class="line"><span class="keyword">const</span> User = mongoose.model(<span class="string">'user'</span>);</span><br><span class="line"></span><br><span class="line">User.create(&#123; <span class="attr">name</span>: <span class="string">'小明'</span>, <span class="attr">age</span>: <span class="number">20</span> &#125;).then(<span class="function"><span class="params">result</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(result);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<h2 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h2><ul>
<li><a href="http://mongoosejs.com/docs/guide.html" target="_blank" rel="noopener">http://mongoosejs.com/docs/guide.html</a></li>
</ul>

        </div>

        <blockquote class="post-copyright">
    <div class="content">
        
<span class="post-time">
    最后更新时间：<time datetime="2021-06-15T06:10:52.828Z" itemprop="dateUpdated">2021年6月15日 14:10</time>
</span><br>


        <br /><b style="color:#f66">版权声明</b> - Lizhooh，未经允许禁止转载！！！经允许的请声明：<div style='height:8px'></div><b>作者</b>：Lizhooh 未来是全栈工程师<br /><b>原文</b>：<a href="/stories/2017/04/MongoDB/学习 Mongoose 的使用/" target="_blank" rel="external">http://me.lizhooh.com/stories/2017/04/MongoDB/学习 Mongoose 的使用/</a>
    </div>
    <footer>
        <a href="http://me.lizhooh.com">
            <img src="/img/my.png" alt="Lizhooh">
            Lizhooh
        </a>
    </footer>
</blockquote>

        


        <div class="post-footer">
            
	<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/MongoDB/">MongoDB</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Nodejs/">Nodejs</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/学习笔记/">学习笔记</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/数据库/">数据库</a></li></ul>


            


        </div>
    </div>

    
<nav class="post-nav flex-row flex-justify-between">
  
    <div class="waves-block waves-effect prev">
      <a href="/stories/2017/04/ECMAScript/ES6 一行代码实现 多数组合并/" id="post-prev" class="post-nav-link">
        <!-- <div class="tips"><i class="icon icon-angle-left icon-lg icon-pr"></i> 上一篇</div> -->
        <h4 class="title">ES6 一行代码实现多数组合并</h4>
        <h4 class="summary">多数组合并今天无聊的时刻突然来了灵感，使用 ES6 一行代码就实现了多数组合并的功能。
其中用到了Array.reduc...</h4>
      </a>
    </div>
  

  
    <div class="waves-block waves-effect next">
      <a href="/stories/2017/04/React/React/前端路由守护与后端用户认证/" id="post-next" class="post-nav-link">
        <!-- <div class="tips">下一篇 <i class="icon icon-angle-right icon-lg icon-pl"></i></div> -->
        <h4 class="title">前端路由守护 与 后端用户认证</h4>
        <h4 class="summary">前端路由守护为了实现在未认证用户试图进入被保护页面时转跳到首页的功能，这里使用的是React-Router 4.0来设置...</h4>
      </a>
    </div>
  
</nav>



    
</article>



</div>

        <footer class="footer">
    <div class="top">
        <p>
            <span><i class="icon icon-lg icon-rss"></i></span>
            <span>博客内容属于原创创作，未授权转载者必追究其法律责任。</span>
        </p>
    </div>
    <div class="bottom">
        <p>
            <span>
                对酒当歌，人生几何！
                <i class="icon icon-heart-o" style="font-weight: bold;"></i>
                Lizhooh 的技术博客 &copy; 
                2016 - 2021

                <!--Power by <a href="http://hexo.io/" target="_blank">Hexo</a>-->
             </span>
        </p>


    </div>
</footer>

    </main>

    <div class="mask" id="mask"></div>
<a href="javascript:;" id="gotop" class="waves-effect waves-circle waves-light"><span class="icon icon-lg icon-chevron-up"></span></a>


    <!--<script src="//cdn.bootcss.com/node-waves/0.7.4/waves.min.js"></script>-->
<script>
var BLOG = { ROOT: '/', SHARE: false, REWARD: false };
</script>

<script src="//lib.baomitu.com/tippy.js/3.0.2/tippy.all.min.js"></script>
<script src="//lib.baomitu.com/jquery/3.3.1/jquery.min.js"></script>
<script src="/js/waves.min.js"></script>
<script src="/js/rest.js"></script>
<script src="/js/main.min.js?v=2.2.0"></script>


<div class="search-panel" id="search-panel">
    <ul class="search-result" id="search-result"></ul>
</div>
<template id="search-tpl">
<li class="item">
    <a href="{path}" class="waves-block waves-effect">
        <div class="title ellipsis" title="{title}">{title}</div>
        <div class="flex-row flex-middle">
            <div class="tags ellipsis">
                {tags}
            </div>
            <time class="flex-col time">{date}</time>
        </div>
    </a>
</li>
</template>

<script async src="/js/search.min.js?v=2.2.0"></script>





    <div class="music" id="music"></div>
</body>
</html>
